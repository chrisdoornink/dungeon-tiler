/* Root-level CSS variables moved to app/globals.css :root for Next.js CSS Modules compatibility */

.tileContainer {
  position: relative;
  width: var(--tile-size);
  height: var(--tile-size);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  margin: 0;
  padding: 0;
  border: none;
  line-height: 0;
  box-sizing: border-box;
}

/* Visibility tier globals moved to app/globals.css */

/* Enhanced torch flickering animations with moderate darker shades */
@keyframes torchFlickerTier2 {
  0% {
    filter: brightness(0.84);
    box-shadow: inset 0 0 30px 10px rgba(0, 0, 0, 0.15);
  }
  25% {
    filter: brightness(0.89);
    box-shadow: inset 0 0 40px 15px rgba(0, 0, 0, 0.09);
  }
  50% {
    filter: brightness(0.82);
    box-shadow: inset 0 0 35px 12px rgba(0, 0, 0, 0.18);
  }
  75% {
    filter: brightness(0.88);
    box-shadow: inset 0 0 42px 16px rgba(0, 0, 0, 0.1);
  }
  100% {
    filter: brightness(0.84);
    box-shadow: inset 0 0 30px 10px rgba(0, 0, 0, 0.15);
  }
}

@keyframes torchFlickerTier1 {
  0% {
    filter: brightness(0.68);
    box-shadow: inset 0 0 40px 15px rgba(0, 0, 0, 0.28);
  }
  20% {
    filter: brightness(0.74);
    box-shadow: inset 0 0 55px 22px rgba(0, 0, 0, 0.2);
  }
  40% {
    filter: brightness(0.66);
    box-shadow: inset 0 0 50px 20px rgba(0, 0, 0, 0.3);
  }
  60% {
    filter: brightness(0.73);
    box-shadow: inset 0 0 60px 25px rgba(0, 0, 0, 0.21);
  }
  80% {
    filter: brightness(0.67);
    box-shadow: inset 0 0 45px 18px rgba(0, 0, 0, 0.29);
  }
  100% {
    filter: brightness(0.68);
    box-shadow: inset 0 0 40px 15px rgba(0, 0, 0, 0.28);
  }
}

/* FOV tier class rules moved to app/globals.css */

/* Border and color utility tokens moved to app/globals.css */

.floor {
  background-color: var(--floor-bg);
  background-image: url("/images/floor/floor-try-1.png");
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  position: relative;
}

/* Add subtle moss overlay to floor tiles */
/* .floor::after {
  content: "";
  position: absolute;
  inset: 0;
  background: radial-gradient(
      circle at 30% 70%,
      rgba(63, 90, 70, 0.15) 0%,
      rgba(63, 90, 70, 0) 30%
    ),
    radial-gradient(
      circle at 80% 20%,
      rgba(63, 90, 70, 0.1) 0%,
      rgba(63, 90, 70, 0) 25%
    );
  mix-blend-mode: overlay;
  pointer-events: none;
} */

.wall {
  background-color: var(--wall-top);
  border: 1px solid var(--wall-side);
}

/* Wall with asset image - no borders or additional styling */
.wallWithAsset {
  background-color: transparent;
  border: none;
}

.wallInsetTexture {
  position: absolute;
  inset: 4px;
  border: 1px solid rgba(255, 255, 255, 0.05);
  border-radius: 2px;
  /* Forest-themed texture with subtle moss effect */
  background: linear-gradient(
      to bottom,
      rgba(63, 90, 70, 0.08),
      rgba(26, 42, 32, 0.12)
    ),
    repeating-linear-gradient(
      45deg,
      transparent,
      transparent 4px,
      rgba(77, 99, 86, 0.03) 4px,
      rgba(77, 99, 86, 0.03) 5px
    );
}

.wallWindowOverlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  background-position: center 72%;
  background-repeat: no-repeat;
  background-size: 60% 60%;
}

.wallDoorOverlay {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
  background-position: center;
  background-repeat: no-repeat;
  background-size: 80% 90%;
}

/* Subtype icons container */
.subtypeContainer {
  position: absolute;
  inset: 0;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  gap: 2px;
  padding: 2px;
  pointer-events: none;
}

/* Individual subtype icon */
.subtypeIcon {
  width: 16px;
  height: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 4px;
  font-size: 10px;
  font-weight: bold;
  color: white;
  text-shadow: 0px 0px 2px rgba(0, 0, 0, 0.8);
}

/* Asset-based subtype icons */
.assetIcon {
  width: 24px;
  height: 24px;
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  position: relative; /* allow z-index stacking over glow */
  z-index: 1;
}

/* Torch icon: CSS-only flame with flicker */
.torchIcon {
  position: absolute;
  bottom: 6px;
  left: 50%;
  transform: translateX(-50%);
  width: 14px;
  height: 20px;
  border-radius: 50% 50% 40% 40%/60% 60% 40% 40%;
  /* Stylized flame using layered gradients */
  background: radial-gradient(
      closest-side at 50% 40%,
      rgba(255, 200, 80, 0.95),
      rgba(255, 140, 0, 0.8) 70%,
      rgba(0, 0, 0, 0) 72%
    ),
    radial-gradient(
      closest-side at 50% 70%,
      rgba(255, 240, 170, 0.9),
      rgba(255, 165, 0, 0.85) 60%,
      rgba(0, 0, 0, 0) 63%
    );
  box-shadow: 0 0 6px 2px rgba(255, 170, 50, 0.55),
    0 0 12px 6px rgba(255, 120, 20, 0.25);
  animation-name: torchFlickerTier2;
  animation-iteration-count: infinite;
  animation-direction: alternate;
  animation-timing-function: ease-in-out;
  z-index: 11500; /* above enemies (10500), below wallTopOverlay (12000) */
}

/* Positioning class for sprite-based wall torch */
.torchSprite {
  position: absolute;
  bottom: 6px;
  left: 50%;
  transform: translateX(-50%);
  width: 18px; /* Slightly larger than CSS flame for clarity */
  height: 24px;
  z-index: 11500; /* above enemies (10500), below wallTopOverlay (12000) */
}

/* Absolute overlay for revealed items to appear above chests */
.overlayIcon {
  position: absolute;
  inset: 0;
  z-index: 5000;
  pointer-events: none;
  margin: auto;
}

/* Special full-height asset icon for doors */
.fullHeightAssetIcon {
  width: 28px;
  height: 40px; /* Full tile height */
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  position: relative;
  z-index: 2; /* Ensure door appears above the floor */
}

.closedChestIcon {
  background-image: url("/images/items/closed-chest.png");
}

.openedChestIcon {
  background-image: url("/images/items/opened-chest.png");
}

.switchIcon {
  background-image: url("/images/items/switch.png");
}

.keyIcon {
  background-image: url("/images/items/key.png");
}

.exitKeyIcon {
  background-image: url("/images/items/exit-key.png");
}

.doorIcon {
  background-image: url("/images/items/door-closed.png");
}

.exitIcon {
  background-image: url("/images/door/exit-dark.png");
  /* Keep subtle emphasis for visibility on floor */
  filter: drop-shadow(0 0 4px rgba(72, 187, 120, 0.4));
  /* Scale up and center */
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 31px; /* 24px * 1.3 */
  height: 31px; /* 24px * 1.3 */
  z-index: 2;
}

/* Gold chain lock overlay for locked exit */
.exitLockIcon {
  background-image: url("/images/door/gold-chain-lock.png");
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  opacity: 0.95;
  /* Scale up and center */
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 31px; /* 24px * 1.3 */
  height: 31px; /* 24px * 1.3 */
  z-index: 3;
}

/* Pots, Rocks, Food, Meds */
.potIcon {
  background-image: url("/images/items/pot-1.png");
}

.rockIcon {
  background-image: url("/images/items/rock-1.png");
}

.foodIcon {
  background-image: url("/images/items/food-1.png");
}

.medIcon {
  background-image: url("/images/items/meds-1.png");
}

/* Rune asset */
.runeIcon {
  background-image: url("/images/items/rune1.png");
}

/* Small pulsing green glow for rune (behind asset) */
.runeGlow {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 28px;
  height: 28px;
  pointer-events: none;
  z-index: 0; /* under assetIcon */
  background: radial-gradient(
      60% 60% at 50% 50%,
      rgba(80, 255, 180, 0.35),
      rgba(80, 255, 180, 0) 70%
    ),
    radial-gradient(
      80% 80% at 50% 50%,
      rgba(60, 210, 150, 0.18),
      rgba(0, 0, 0, 0) 75%
    );
  filter: blur(2px) saturate(115%);
  mix-blend-mode: screen;
  animation: runePulse 2.4s ease-in-out infinite;
}

@keyframes runePulse {
  0% {
    transform: translate(-50%, -50%) scale(0.95);
    opacity: 0.45;
    filter: blur(2.2px) saturate(110%);
  }
  50% {
    transform: translate(-50%, -50%) scale(1.08);
    opacity: 0.9;
    filter: blur(2px) saturate(125%);
  }
  100% {
    transform: translate(-50%, -50%) scale(0.95);
    opacity: 0.45;
    filter: blur(2.2px) saturate(110%);
  }
}

/* Sword and Shield assets */
.swordIcon {
  background-image: url("/images/items/sword.png");
}

.shieldIcon {
  background-image: url("/images/items/shield.png");
}

/* Faulty floor overlay: cracks on floor tiles */
.faultyFloorIcon {
  position: absolute;
  left: 50%;
  top: 50%;
  /* transform is set inline with random rotation */
  width: 32px;
  height: 32px;
  z-index: 2;
  background-image: url("/images/floor/crack3.png");
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  opacity: 1;
}

/* Darkness tile: dark pit when faulty floor collapses */
.darkness {
  background-color: #0a0a0a;
  background-image: none;
  box-shadow: inset 0 0 20px 5px rgba(0, 0, 0, 0.8);
  border: 1px solid #1a1a1a;
}

@keyframes exitPulse {
  0% {
    transform: translate(-50%, -50%) scale(1);
    filter: drop-shadow(0 0 5px rgba(72, 187, 120, 0.45));
    opacity: 0.55;
  }
  100% {
    transform: translate(-50%, -50%) scale(1.08);
    filter: drop-shadow(0 0 9px rgba(72, 187, 120, 0.85));
    opacity: 0.85;
  }
}

/* Soft pulsing green glow behind the exit icon */
.exitGlow {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 32px;
  height: 32px;
  pointer-events: none;
  z-index: 0; /* under assetIcon */
  background: radial-gradient(
      62% 62% at 50% 50%,
      rgba(82, 245, 160, 0.35),
      rgba(0, 0, 0, 0) 70%
    ),
    radial-gradient(
      86% 86% at 50% 50%,
      rgba(72, 187, 120, 0.18),
      rgba(0, 0, 0, 0) 75%
    );
  filter: blur(1.8px) saturate(112%);
  mix-blend-mode: screen;
  animation: exitPulse 2.2s ease-in-out infinite alternate;
}

@keyframes exitPulseUnlocked {
  0% {
    transform: translate(-50%, -50%) scale(1.06);
    filter: drop-shadow(0 0 8px rgba(82, 245, 160, 0.65));
    opacity: 0.75;
  }
  100% {
    transform: translate(-50%, -50%) scale(1.22);
    filter: drop-shadow(0 0 14px rgba(82, 245, 160, 0.95));
    opacity: 1;
  }
}

/* Larger/brighter pulse when player has the exit key */
.exitGlowUnlocked {
  width: 36px;
  height: 36px;
  background: radial-gradient(
      64% 64% at 50% 50%,
      rgba(82, 245, 160, 0.42),
      rgba(0, 0, 0, 0) 72%
    ),
    radial-gradient(
      90% 90% at 50% 50%,
      rgba(72, 187, 120, 0.24),
      rgba(0, 0, 0, 0) 78%
    );
  animation: exitPulseUnlocked 1.9s ease-in-out infinite alternate;
}

/* Variant: wall_pillar (front perspective) */
.wallPillar {
  /* 70% bottom base for strong perspective: 28px on 40px tile */
  border-bottom-width: calc(var(--tile-size) * 0.7);
  border-bottom-style: solid;
  border-bottom-color: var(--wall-bottom); /* bottom face derived from top */

  /* Thin side faces (front view) */
  border-left: 2px solid var(--wall-side);
  border-right: 2px solid var(--wall-side);
}

/* Helpers for other variants */
.wallBase70 {
  border-bottom-width: calc(var(--tile-size) * 0.7);
  border-bottom-style: solid;
  border-bottom-color: var(--wall-bottom);
}

.wallEdgeL {
  border-left: 2px solid var(--wall-side);
}

.wallEdgeR {
  border-right: 2px solid var(--wall-side);
}

/* Edge highlights when no same-type neighbor - forest style */
.wallTopHighlight::after {
  content: "";
  position: absolute;
  top: 0;
  left: 2px;
  right: 2px;
  height: 1px;
  background: linear-gradient(
    to right,
    transparent,
    var(--edge-highlight),
    var(--forest-accent),
    var(--edge-highlight),
    transparent
  );
}

.wallRightHighlight::before {
  content: "";
  position: absolute;
  top: 2px;
  bottom: 2px;
  right: 0;
  width: 1px;
  background: linear-gradient(
    to bottom,
    transparent,
    var(--edge-highlight),
    var(--forest-accent),
    var(--edge-highlight),
    transparent
  );
}

.wallLeftHighlight::before {
  content: "";
  position: absolute;
  top: 2px;
  bottom: 2px;
  left: 0;
  width: 1px;
  background: linear-gradient(
    to bottom,
    transparent,
    var(--edge-highlight),
    var(--forest-accent),
    var(--edge-highlight),
    transparent
  );
}

/* Exaggerated base shadow strip */
.wallBaseShadow {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 8px; /* stronger visual than h-2 */
  background: linear-gradient(
    to bottom,
    color-mix(in srgb, var(--wall-bottom) 20%, #000 0%) 0%,
    color-mix(in srgb, var(--wall-bottom) 75%, #000 25%) 100%
  );
}

.player {
  background: transparent; /* Changed from blue to transparent to show the hero image */
  color: white;
  position: relative;
}

/* Hero character image */
.heroImage {
  width: 100%;
  height: 100%;
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  z-index: 2; /* Ensure hero appears above the floor */
  background-color: transparent; /* Make sure background is transparent */
}

/* Candle glow effect for player tile */
.player::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  border-radius: 50%;
  box-shadow: 0 0 20px 10px rgba(255, 165, 0, 0.4);
  z-index: 1; /* Below the hero image */
  pointer-events: none; /* Allow clicks to pass through */
  animation: candleFlicker 2s infinite alternate;
}

/* Wall top overlay for floor tiles with walls below */
.wallTopOverlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 33%; /* Bottom third of the tile */
  background-position: center top; /* Show the top portion of the wall image */
  background-size: 100% 300%; /* Make the image 3x taller than the container to show only top third */
  z-index: 12000; /* Above fog (10000) and eyes (11000) to occlude enemies properly */
  pointer-events: none; /* Allow clicks to pass through */
}

@keyframes candleFlicker {
  0%,
  100% {
    opacity: 0.7;
  }
  25% {
    opacity: 0.8;
  }
  50% {
    opacity: 0.6;
  }
  75% {
    opacity: 0.9;
  }
}

.invisible {
  background: #1b1b1b; /* requested darker neutral */
}

/* Eerie green glow for stone-exciter when near the hero */
.exciterGlow {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 10490; /* just below enemy sprite (10500) */
  /* Stronger multi-layered green glow */
  background: radial-gradient(
      62% 62% at 50% 45%,
      rgba(80, 255, 180, 0.28),
      rgba(80, 255, 180, 0.14) 45%,
      rgba(0, 0, 0, 0) 75%
    ),
    radial-gradient(
      90% 90% at 50% 55%,
      rgba(60, 210, 150, 0.09),
      rgba(0, 0, 0, 0) 60%
    );
  filter: blur(2.5px) saturate(110%);
  mix-blend-mode: screen; /* lift glow over darker tiles */
  animation: exciterPulse 2.6s ease-in-out infinite;
}

@keyframes exciterPulse {
  0% {
    transform: translateY(-6px) scale(0.95);
    opacity: 0.42;
    filter: blur(2.5px) saturate(110%);
  }
  50% {
    transform: translateY(-6px) scale(1.08);
    opacity: 0.72;
    filter: blur(2.3px) saturate(125%);
  }
  100% {
    transform: translateY(-6px) scale(0.95);
    opacity: 0.42;
    filter: blur(2.5px) saturate(110%);
  }
}
